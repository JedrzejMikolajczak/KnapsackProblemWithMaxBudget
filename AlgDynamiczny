import json
 
 
def wczytaj_dane(nazwa_pliku):
    try:
        with open(nazwa_pliku, 'r') as plik:
            dane = json.load(plik)
        return dane['przedmioty'], dane['max_waga'], dane['max_budzet']
    except FileNotFoundError:
        print(f"Błąd: Nie znaleziono pliku {nazwa_pliku}")
        return [], 0, 0
    except json.JSONDecodeError:
        print(f"Błąd: Plik {nazwa_pliku} ma niepoprawny format JSON")
        return [], 0, 0
    except KeyError as e:
        print(f"Błąd struktury danych: brakuje klucza {e}")
        return [], 0, 0
 
 
def algorytm_dynamiczny(przedmioty, max_waga, max_budzet):
    n = len(przedmioty)
 
    # V[i][w][b] i: numer przedmiotu, w: aktualna waga, b: aktualny budżet
    V = [[[0] * (max_budzet + 1) for _ in range(max_waga + 1)] for _ in range(n + 1)]
 
 
    for i in range(1, n + 1):
        p = przedmioty[i - 1]
        w_i = p['waga']
        val_i = p['wartosc']
        k_i = p['koszt']
 
        for w in range(max_waga + 1):
            for b in range(max_budzet + 1):
                if w_i > w or k_i > b:
                    V[i][w][b] = V[i - 1][w][b]
                else:
                    nie_bierzemy = V[i - 1][w][b]
                    bierzemy = V[i - 1][w - w_i][b - k_i] + val_i
                    V[i][w][b] = max(nie_bierzemy, bierzemy)
    plecak = []
    curr_w = max_waga
    curr_b = max_budzet
 
    for i in range(n, 0, -1):
        if V[i][curr_w][curr_b] != V[i - 1][curr_w][curr_b]:
            przedmiot = przedmioty[i - 1]
            plecak.append(przedmiot)
 
            curr_w -= przedmiot['waga']
            curr_b -= przedmiot['koszt']
 
    plecak.reverse()
    max_wartosc = V[n][max_waga][max_budzet]
 
    waga_koncowa = sum(p['waga'] for p in plecak)
    koszt_koncowy = sum(p['koszt'] for p in plecak)
 
    return plecak, max_wartosc, waga_koncowa, koszt_koncowy
 
 
def uruchom(nazwapliku):
    lista_przedmiotow, limit_wagi, limit_budzetu = wczytaj_dane(nazwapliku)
 
    if not lista_przedmiotow:
        print("Brak przedmiotów do przetworzenia.")
        return
    plecak, wartosc, waga, koszt = algorytm_dynamiczny(lista_przedmiotow, limit_wagi, limit_budzetu)
 
    print(f"Calkowita wartosc: {wartosc}")
    print(f"Wykorzystana waga: {waga} / {limit_wagi}")
    print(f"Wykorzystany budzet: {koszt} / {limit_budzetu}")
    print("Wybrane przedmioty:")
 
    for p in plecak:
        print(f"{p['nazwa']} (Wartosc: {p['wartosc']}, Waga: {p['waga']}, Koszt: {p['koszt']})")
 
 
if __name__ == "__main__":
    uruchom('dane.json')
